<div class="entry-content">
<p>今日は水遣りの制御を考えてみました。<br/><br/>＜仕様＞<br/>土壌センサがある一定の乾き具合になったと判断したら、水をあげます。<br/>水遣りを実行したら、一定時間は水遣りを実行しません。<br/>土壌の乾き具合を人の目に分かるように通知します。<br/>手動水遣りボタンが押されたら、状況にかかわらず水遣りを実行します。<br/><br/>＜変数の定義＞<br/>水遣りの敷居値（乾き具合）として Thresholdを定義。<br/>土壌の乾き具合を　Soilと定義。<br/>水遣りのRetry回数をカウントする　Retryを定義。<br/>土壌の判定具合を通知するため、Stateを定義。<br/><br/>＜動作イメージ＞<br/>自動チェックは3時間に一回（60m*60s*3h*1000ms)<br/>土壌の状態に応じて、LEDで通知<br/>　十分に水が供給されている　= Blue<br/>   程よく水が含まれている = Green<br/>  もう少しで、水遣りが必要　=　Yellow<br/>  水を上げたが渇きが解消されない　= 水タンクEmpty = 警告！<br/>手動水遣りボタンが押されたら、土壌の状態によらず水遣り実行<br/><br/>＜実装イメージ＞<br/>実際にプログラムを組むときの骨格</p>
<p><img alt="f:id:s51517765:20190105113020j:plain" class="hatena-fotolife" src="https://cdn-ak.f.st-hatena.com/images/fotolife/s/s51517765/20190105/20190105113020.jpg" title="f:id:s51517765:20190105113020j:plain"/></p>
<p><br/>以前に書いた、土壌センサを用いますので、土壌が乾いたときは最大1024が表示され、乾いているほどセンサ数値は大きくなります。<br/><br/>ここでは、仮に700を超えたら乾いていて水やりが必要と定義します。<br/>if文を用いて、繋いでいきます。<br/><br/>たとえば、十分水が与えられている状態でセンサ読み値Soilが300であれば、Blueです。<br/>501であればThreshold-200 = 700-200 = 500より大きいので、Yellowです。<br/><br/>一方、700より大きければ、水遣りを実行します。<br/>ここで、Retryで水遣り回数をカウントアップします。<br/>3分待った後、Retry回数をチェックし、2未満なのでもう一度判定に戻ってきます。<br/>もう一度Soilを確認し、700より大きければ、もう一度水遣りをします。<br/>水遣りとチェックを繰り返しても700以下にならなければ、水遣りができていないとし、警告を出しRedを表示します。<br/><br/>水遣りから3分待つのは、土壌に染み渡る時間を待ってチェックするためです。<br/>判定間隔3時間や、渇きの敷居値700は実装しながら設定していきます。</p>
</div>