<div class="entry-content">
<p><iframe class="embed-card embed-webcard" frameborder="0" scrolling="no" src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Ftwitter.com%2Fs51517765" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="プログラミング素人 (@s51517765) | Twitter"></iframe><cite class="hatena-citation"><a href="https://twitter.com/s51517765">twitter.com</a></cite></p><p>このブログでも紹介している、というか現在の私のメインワークの<a class="keyword" href="http://d.hatena.ne.jp/keyword/twitter">twitter</a> <a class="keyword" href="http://d.hatena.ne.jp/keyword/bot">bot</a>ですが、ラズパイで運用しています。<br/>
ラズパイはそれ自身もRaspbianという<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a> OSの一種なので、これ自身でプログラミングからサーバーとしてまで運用できます。しかし、<a class="keyword" href="http://d.hatena.ne.jp/keyword/windows">windows</a>のPCをつかうほうが何かと開発環境として高級で、PCとしての処理能力も高いことは言うまでもありません。<br/>
したがって、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>上で作成したプログラムを<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>(<a class="keyword" href="http://d.hatena.ne.jp/keyword/teraterm">teraterm</a>など)でラズパイに転送し、<a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a>プログラムを走らせるということを行っています。</p><p>ここで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a>プログラムを走らせて、そのまま<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>をログオフすると、プログラムが止まってしまいます。<br/>
これを、<a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a>を終了せずに接続を切りたいと思っても通常は出来ません。<br/>
これは親子関係にあるプロセスは親(ここでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/windows">windows</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/teraterm">teraterm</a>)が切られると、子も切られるという原則に従うからです。<br/>
ちょっとこれは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>素人がラズパイを使う上で躓くポイントだと思うので、その他の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>の基本コマンドとともにまとめておきたいと思います。</p><p>まず、Windous(もしくは<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>)をログオフしても<a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a>を残しておく方法です。<a class="keyword" href="http://d.hatena.ne.jp/keyword/teraterm">teraterm</a>などから</p>
<pre class="code" data-lang="" data-unlink="">$ nohup python3 *****.py bg</pre><p>として実行します。($ ははじめから<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>コンソールに表示されていますので、nohup以下を入力します。)<br/>
これで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/teraterm">teraterm</a>を切断しても、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>をログオフしてもプロセスが残ります。</p><p>次に、止めるときはpsコマンドでプロセス番号を確認して、killします。</p>
<pre class="code" data-lang="" data-unlink="">$ ps aux</pre><p><span itemscope="" itemtype="http://schema.org/Photograph"><img alt="f:id:s51517765:20171225223053j:plain" class="hatena-fotolife" itemprop="image" src="https://cdn-ak.f.st-hatena.com/images/fotolife/s/s51517765/20171225/20171225223053.jpg" title="f:id:s51517765:20171225223053j:plain"/></span></p><p>pi Userでpython3 のプロセスがあり、プロセスIDが22150であることが分かります。</p>
<pre class="code" data-lang="" data-unlink="">$ kill -9 ****</pre><p>ここでは kill -9 22150と入力します。</p><p>もう一度、psコマンドを呼ぶと、プロセスが消えていることが確認できるはずです。</p><p>nohupモードで走らせた<a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a>プログラムでは、print()やエラーメッセージなど、コンソール画面の出力は"nohup.out"に出力されます。<br/>
あとでこのnohup.outを確認することで動作結果を確認することができます。<br/>
カレントフォルダにあるファイルの一覧はlsで表示されます。</p>
<pre class="code" data-lang="" data-unlink="">$ ls</pre><p>テキストファイルはnanoというアプリで表示/編集できます。<br/>
（nanoでの編集はめんどくさいのであまり使ったことはありません）</p>
<pre class="code" data-lang="" data-unlink="">$ nano nohup.out</pre><p>nanoの表示の終了は「ctrl」+「x」</p><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>標準のnanoでもテキストの確認はできますが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>にダウンロードするほうが見やすいです。<br/>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/teraterm">teraterm</a>のSCPという機能を利用します。ファイルメニューの￥<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a> SCPで起動します。<br/>
<span itemscope="" itemtype="http://schema.org/Photograph"><img alt="f:id:s51517765:20171225224229j:plain" class="hatena-fotolife" itemprop="image" src="https://cdn-ak.f.st-hatena.com/images/fotolife/s/s51517765/20171225/20171225224229.jpg" title="f:id:s51517765:20171225224229j:plain"/></span></p><p>反対にアップロードは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/teraterm">teraterm</a>のコンソール画面にドラッグ＆ドロップでできます。</p><p>その他、よく使うコマンドを一気に紹介。</p><p>カレント<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リの表示</p>
<pre class="code" data-lang="" data-unlink="">$ pwd</pre><p>ファイルの削除（警告なし）</p>
<pre class="code" data-lang="" data-unlink="">$ rm -f ***</pre><p>ラズパイのシャットダウン</p>
<pre class="code" data-lang="" data-unlink="">$ sudo shutdown -h</pre><p>ラズパイの再起動</p>
<pre class="code" data-lang="" data-unlink="">$ sudo shutdown -r now</pre><p>※2018/01/29 追記<br/>
ラズパイからYes or Noを訊かれたとき"大文字のY"だったら、そのまま空欄でエンターでも"Y"と判断される。</p>
<pre class="code" data-lang="" data-unlink="">Do you want to continue? [Y/n]</pre>
</div>