<div class="entry-content">
<div class="section">
<h3>elchikaのハードウェア作品投稿キャンペーンでM5Stack他をもらいました</h3>
<p><span itemscope="" itemtype="http://schema.org/Photograph"><img alt="f:id:s51517765:20210424155448j:plain" class="hatena-fotolife" itemprop="image" src="https://cdn-ak.f.st-hatena.com/images/fotolife/s/s51517765/20210424/20210424155448.jpg" title=""/></span><br/>
<iframe class="embed-card embed-webcard" frameborder="0" scrolling="no" src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Felchika.com%2Fpromotion%2Fakihabara2021%2F" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="ハードウェア作品投稿キャンペーン | elchika"></iframe><cite class="hatena-citation"><a href="https://elchika.com/promotion/akihabara2021/">elchika.com</a></cite></p><p>M5Stackを使ってみたいな、と思っていたので真っ先にこれを選択。あとはちょっといいテスターが欲しかったのでデジタルマルチメーターと、何にでも使えそうな<a class="keyword" href="http://d.hatena.ne.jp/keyword/%BD%A9%B7%EE%C5%C5%BB%D2">秋月電子</a>の商品券にしました。</p>
</div>
<div class="section">
<h3>早速M5Stackに入門</h3>
<p><iframe class="embed-card embed-webcard" frameborder="0" scrolling="no" src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fraspberrypi.mongonta.com%2Fhowto-start-m5stack-arduinoide%2F" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="初心者向けM5Stackの始め方（ArduinoIDE編） | ラズパイ好きの日記"></iframe><cite class="hatena-citation"><a href="https://raspberrypi.mongonta.com/howto-start-m5stack-arduinoide/">raspberrypi.mongonta.com</a></cite><br/>
セットアップはこちらを参考にしました。<br/>
ESP32はセットアップ済みなのでボード情報はインストール済みで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%D0%A5%A4%A5%B9%A5%C9%A5%E9%A5%A4%A5%D0">デバイスドライバ</a>（CP210X Driver）のインストールとライブラリの追加でＯＫでした。</p><p>・<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%D0%A5%A4%A5%B9%A5%C9%A5%E9%A5%A4%A5%D0">デバイスドライバ</a>のインストール<br/>
<iframe class="embed-card embed-webcard" frameborder="0" scrolling="no" src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fshop.m5stack.com%2Fpages%2Fdownload" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="Download"></iframe><cite class="hatena-citation"><a href="https://shop.m5stack.com/pages/download">shop.m5stack.com</a></cite><br/>
・ボード情報のインストール<br/>
<span itemscope="" itemtype="http://schema.org/Photograph"><img alt="f:id:s51517765:20210424155952j:plain" class="hatena-fotolife" itemprop="image" src="https://cdn-ak.f.st-hatena.com/images/fotolife/s/s51517765/20210424/20210424155952.jpg" title=""/></span><br/>
・M5Stackののライブラリのインストール<br/>
<span itemscope="" itemtype="http://schema.org/Photograph"><img alt="f:id:s51517765:20210424160042j:plain" class="hatena-fotolife" itemprop="image" src="https://cdn-ak.f.st-hatena.com/images/fotolife/s/s51517765/20210424/20210424160042.jpg" title=""/></span></p><p>あとは、ボードとして<code>ESP32 Arduino ¥ M5Stack-CoreoESP32</code>を選択します。<br/>
<span itemscope="" itemtype="http://schema.org/Photograph"><img alt="f:id:s51517765:20210424161405p:plain" class="hatena-fotolife" itemprop="image" src="https://cdn-ak.f.st-hatena.com/images/fotolife/s/s51517765/20210424/20210424161405.png" title=""/></span><br/>
</p>
</div>
<div class="section">
<h3>動かしてみる</h3>
<p>Buttonのサンプルコードにちょっと手を加えたものですが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>から動くところまでやってみました。</p><blockquote class="twitter-tweet" data-conversation="none" data-lang="ja"><p dir="ltr" lang="ja">elchikaのハードウェア作品投稿のプレゼントでM5stackに入門しました。<br/><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>が結構時間かかるなぁ、とおもって測ってみると書き込み完了まで1分ぐらい。<br/>初回はもっと時間かかっていた気がするが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/IDE">IDE</a>かドライバの初期化とかしているのだろうか？ <a href="https://t.co/jIvcaWejAs">pic.twitter.com/jIvcaWejAs</a></p>— とりてん (@s51517765) <a href="https://twitter.com/s51517765/status/1385835216489443328?ref_src=twsrc%5Etfw">2021年4月24日</a></blockquote> <script async="" charset="utf-8" src="https://platform.twitter.com/widgets.js"></script> <br/>
ESP32系？は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Arduino">Arduino</a>よりかなり時間がかかりますね。<p></p><blockquote class="twitter-tweet" data-conversation="none" data-lang="ja"><p dir="ltr" lang="ja">ボタンの読み取り、画面の回転、バッテリーレベルの表示、文字サイズの変更が出来た。画面の初期値は90°回転した状態になっているらしい。<a href="https://twitter.com/hashtag/M5Stack?src=hash&amp;ref_src=twsrc%5Etfw">#M5Stack</a> <a href="https://t.co/rZjnFh0FxU">pic.twitter.com/rZjnFh0FxU</a></p>— とりてん (@s51517765) <a href="https://twitter.com/s51517765/status/1385864952724918280?ref_src=twsrc%5Etfw">2021年4月24日</a></blockquote> <script async="" charset="utf-8" src="https://platform.twitter.com/widgets.js"></script>
</div>
<div class="section">
<h3>まとめ</h3>
<p>M5Stackはボタンとディスプレイがついていていいですね。<br/>
それにしてもelchikaさん太っ腹。<br/>
つぎはobnizのコンテストが開催されています（こちらはパス）。<br/>
<iframe class="embed-card embed-webcard" frameborder="0" scrolling="no" src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Felchika.com%2Fpromotion%2Fobniz2021%2F" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" title="obniz IoT コンテスト 2021 | elchika"></iframe><cite class="hatena-citation"><a href="https://elchika.com/promotion/obniz2021/">elchika.com</a></cite><br/>
</p>
<pre class="code lang-c" data-lang="c" data-unlink=""><span class="synPreProc">#include </span><span class="synConstant">&lt;M5Stack.h&gt;</span>
<span class="synComment">// The setup() function runs once each time the micro-controller starts</span>
<span class="synType">void</span> setup() {
  <span class="synComment">// init lcd, serial, but don't init sd card</span>
  M5.begin(<span class="synConstant">true</span>, <span class="synConstant">false</span>, <span class="synConstant">true</span>);

  <span class="synComment">/*</span>
<span class="synComment">    Power chip connected to gpio21, gpio22, I2C device</span>
<span class="synComment">    Set battery charging voltage and current</span>
<span class="synComment">    If used battery, please call this function in your project</span>
<span class="synComment">  */</span>
  M5.Power.begin();
  M5.Lcd.clear(BLACK);
  M5.Lcd.setTextColor(YELLOW);
  M5.Lcd.setTextSize(<span class="synConstant">3</span>);
  M5.Lcd.setCursor(<span class="synConstant">65</span>, <span class="synConstant">10</span>);
  M5.Lcd.println(<span class="synConstant">"Button example"</span>);
  M5.Lcd.setCursor(<span class="synConstant">3</span>, <span class="synConstant">35</span>);
  M5.Lcd.println(<span class="synConstant">"Press button B for 700ms"</span>);
  M5.Lcd.println(<span class="synConstant">"to clear screen."</span>);
  M5.Lcd.setTextColor(RED);
}

<span class="synType">void</span> showBattery() {
  <span class="synType">int</span> BatteryLv = M5.Power.getBatteryLevel();

  <span class="synStatement">if</span> (BatteryLv &lt; <span class="synConstant">40</span>)  M5.Lcd.setTextColor(RED);
  <span class="synStatement">else</span>   M5.Lcd.setTextColor(GREEN);
  M5.Lcd.setTextSize(<span class="synConstant">3</span>);
  M5.Lcd.print(BatteryLv);
  M5.Lcd.print(<span class="synConstant">"["</span>);
  <span class="synStatement">for</span> (<span class="synType">int</span> i = <span class="synConstant">0</span>; i &lt; <span class="synConstant">5</span>; i++) {
    <span class="synStatement">if</span> (i * <span class="synConstant">20</span> &lt; BatteryLv) M5.Lcd.print(<span class="synConstant">"#"</span>);
    <span class="synStatement">else</span> M5.Lcd.print(<span class="synConstant">" "</span>);
  }
  M5.Lcd.println(<span class="synConstant">"]"</span>);
  M5.Lcd.setTextColor(YELLOW);
  M5.Lcd.setTextSize(<span class="synConstant">5</span>);
}
<span class="synType">int</span> rotate = <span class="synConstant">0</span>;
<span class="synType">void</span> loop() {
  <span class="synComment">// update button state</span>
  M5.update();

  <span class="synComment">// if you want to use Releasefor("was released for"), use .wasReleasefor(int time) below</span>
  <span class="synStatement">if</span> (M5.BtnA.wasReleased() || M5.BtnA.pressedFor(<span class="synConstant">1000</span>, <span class="synConstant">200</span>)) {
    M5.Lcd.print(<span class="synConstant">"AAA"</span>);
  } <span class="synStatement">else</span> <span class="synStatement">if</span> (M5.BtnB.wasReleased() || M5.BtnB.pressedFor(<span class="synConstant">1000</span>, <span class="synConstant">200</span>)) {
    M5.Lcd.print(<span class="synConstant">"BBB"</span>);
  } <span class="synStatement">else</span> <span class="synStatement">if</span> (M5.BtnC.wasReleased() || M5.BtnC.pressedFor(<span class="synConstant">1000</span>, <span class="synConstant">200</span>)) {
    M5.Lcd.clear(BLACK);
    <span class="synComment">//  M5.Lcd.print(rotate);</span>
    M5.Lcd.print(<span class="synConstant">"EEE"</span>);
    M5.Lcd.setRotation(rotate++);
    <span class="synStatement">if</span> (rotate &gt; <span class="synConstant">3</span>)rotate = <span class="synConstant">0</span>;

  } <span class="synStatement">else</span> <span class="synStatement">if</span> (M5.BtnB.wasReleasefor(<span class="synConstant">700</span>)) {
    M5.Lcd.clear(BLACK);
    M5.Lcd.setCursor(<span class="synConstant">0</span>, <span class="synConstant">0</span>);
    showBattery();
  }
}
</pre><p></p><div class="hatena-asin-detail"><a href="https://www.amazon.co.jp/exec/obidos/ASIN/B07BW2BLY1/shirotoakb-22/"><img alt="M5Stack Basic" class="hatena-asin-detail-image" src="https://m.media-amazon.com/images/I/31Bthm3mxCL._SL500_.jpg" title="M5Stack Basic"/></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="https://www.amazon.co.jp/exec/obidos/ASIN/B07BW2BLY1/shirotoakb-22/">M5Stack Basic</a></p><ul><li><span class="hatena-asin-detail-label">メディア:</span> おもちゃ＆ホビー</li></ul></div><div class="hatena-asin-detail-foot"></div></div>
</div>
</div>